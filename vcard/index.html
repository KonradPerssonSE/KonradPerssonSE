<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#111111" />
  <title>Share to Struct</title>
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Serif:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="app.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <div class="title">Share to Struct</div>
      <div class="subtitle">Screenshot → OCR → Contact</div>
    </div>

    <nav class="tabs" role="tablist" aria-label="Sections">
      <button class="tab" data-tab="info" role="tab" aria-selected="true">Text from images</button>
      <button class="tab" data-tab="contacts" role="tab" aria-selected="false">Contacts</button>
      <button class="tab" data-tab="tool" role="tab" aria-selected="false">Make contact</button>
    </nav>
  </header>

  <main class="wrap">
    <!-- INFO TAB -->
    <section class="panel" id="tab-info" role="tabpanel">
      <h1>Getting text from images on Android</h1>
      <p>
        A PWA can’t scan your whole gallery automatically. Android + browsers require you to
        <em>pick</em> files or <em>share</em> files into the app.
      </p>

      <h2>Fast paths</h2>
      <ol>
        <li><strong>Share sheet:</strong> in Photos/Files → Share → <em>Share to Struct</em> (installed PWA)</li>
        <li><strong>File picker:</strong> choose one or more screenshots/photos</li>
        <li><strong>Camera:</strong> capture a contact card / screen on your old phone</li>
      </ol>

      <h2>How it works (simple mental model)</h2>
      <ul>
        <li><strong>OCR:</strong> we turn pixels into text locally (Tesseract.js).</li>
        <li><strong>Structuring:</strong> we guess fields (name, phone, email…).</li>
        <li><strong>Review:</strong> you compare image ↔ extracted fields and fix mistakes.</li>
        <li><strong>Export:</strong> vCard/CSV/JSON for import into your contacts.</li>
      </ul>

      <h2>Prompt starters (for “structure & clean”)</h2>
      <div class="prompt">
        <p><strong>Extract contact JSON</strong></p>
        <pre><code>You will be given OCR text from a screenshot of a contact.
Return ONLY JSON with:
{
  "firstName": "",
  "lastName": "",
  "phones": [{"type":"mobile","value":""}],
  "emails": [{"type":"work","value":""}],
  "org": "",
  "title": "",
  "note": ""
}
Rules: infer best guesses, normalize phone to E.164 if possible, never hallucinate unknown data.</code></pre>
      </div>

      <div class="prompt">
        <p><strong>Normalize Swedish/European phones</strong></p>
        <pre><code>Normalize these phone numbers to E.164 with country=SE if missing.
Return JSON: {"phones":[...]} only, keep original if uncertain.</code></pre>
      </div>

      <h2>Roadmap (future “recipes”)</h2>
      <ul>
        <li>Events: invite details → iCalendar</li>
        <li>Places: address snippets → map-ready records</li>
        <li>Recipes: ingredient lists → structured recipe JSON</li>
      </ul>
    </section>

    <!-- CONTACTS TAB -->
    <section class="panel hidden" id="tab-contacts" role="tabpanel">
      <h1>Contacts & formats</h1>
      <p>
        Internally we store a clean <strong>JSON</strong> record. You can export to
        <strong>vCard (.vcf)</strong> or <strong>CSV</strong>.
      </p>

      <div class="row">
        <button class="btn" id="btn-export-all-vcf">Export all → vCard</button>
        <button class="btn" id="btn-export-all-csv">Export all → CSV</button>
        <button class="btn" id="btn-export-all-json">Export all → JSON</button>
        <button class="btn subtle" id="btn-wipe-db">Delete local DB</button>
      </div>

      <h2>Saved contacts (local only)</h2>
      <div id="contacts-list" class="list"></div>

      <h2>Prompt starters (conversion & enrichment)</h2>
      <div class="prompt">
        <p><strong>Convert vCard to clean JSON</strong></p>
        <pre><code>Convert this vCard into JSON with fields:
firstName, lastName, phones[], emails[], org, title, note.
Return ONLY JSON. Preserve all phone/email values.</code></pre>
      </div>

      <div class="prompt">
        <p><strong>Merge duplicates</strong></p>
        <pre><code>Given these two contact JSON objects, merge them.
Prefer the one with more complete name. Combine phones/emails uniquely.
Return ONLY merged JSON.</code></pre>
      </div>
    </section>

    <!-- TOOL TAB -->
    <section class="panel hidden" id="tab-tool" role="tabpanel">
      <h1>Make a contact</h1>

      <div class="row">
        <label class="file">
          <input id="file-input" type="file" accept="image/*" multiple />
          <span class="btn">Pick images</span>
        </label>

        <label class="file">
          <input id="camera-input" type="file" accept="image/*" capture="environment" />
          <span class="btn subtle">Camera</span>
        </label>

        <button class="btn subtle" id="btn-speech">Voice input</button>
      </div>

      <div class="row">
        <textarea id="raw-text" placeholder="…or paste/enter text here"></textarea>
      </div>

      <details class="settings">
        <summary>Optional AI enhancement (BYO OpenAI key)</summary>
        <div class="row">
          <input id="openai-key" type="password" placeholder="OpenAI API key (stored only if you choose)" />
          <label class="check">
            <input id="remember-key" type="checkbox" />
            Remember on this device
          </label>
        </div>
        <div class="row">
          <input id="openai-model" type="text" value="gpt-5.2" />
          <button class="btn subtle" id="btn-test-openai">Test key</button>
        </div>
        <p class="hint">
          This step sends OCR text (not the image) to OpenAI to structure/clean fields.
        </p>
      </details>

      <div class="row">
        <button class="btn" id="btn-ocr">OCR images → text</button>
        <button class="btn" id="btn-structure">Text → structured contact</button>
        <button class="btn subtle" id="btn-save">Save to local contacts</button>
      </div>

      <div id="status" class="status" aria-live="polite"></div>

      <div class="compare">
        <figure class="preview">
          <img id="img-preview" alt="Selected image preview" />
          <figcaption>Original (not saved)</figcaption>
        </figure>

        <form class="form" id="contact-form">
          <div class="grid">
            <label>First name <input id="firstName" autocomplete="given-name"></label>
            <label>Last name <input id="lastName" autocomplete="family-name"></label>
          </div>

          <label>Mobile phone <input id="phoneMobile" inputmode="tel" autocomplete="tel"></label>
          <label>Email <input id="emailMain" inputmode="email" autocomplete="email"></label>

          <div class="grid">
            <label>Organization <input id="org"></label>
            <label>Title <input id="title"></label>
          </div>

          <label>Note <textarea id="note" rows="4"></textarea></label>

          <div class="row">
            <button type="button" class="btn subtle" id="btn-vcf">Get vCard</button>
            <button type="button" class="btn subtle" id="btn-csv">Get CSV</button>
            <button type="button" class="btn subtle" id="btn-json">Get JSON</button>
            <button type="button" class="btn" id="btn-share">Share…</button>
          </div>

          <div id="download-area" class="downloads"></div>
        </form>
      </div>

      <p class="hint">
        Tip: rotate to landscape for side-by-side comparison.
      </p>
    </section>
  </main>

  <!-- Tesseract.js (CDN) -->
  <script src="https://unpkg.com/tesseract.js@5.1.1/dist/tesseract.min.js"></script>
  <script src="app.js"></script>
</body>
</html>