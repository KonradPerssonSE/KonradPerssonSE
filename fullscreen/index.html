<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fullscreen Viewer v2</title>
    <link rel="manifest" href="manifest.json">
    
    <!-- React & Tailwind Setup -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script>
        const Icon = ({ name, size = 20, className = "", ...props }) => {
            React.useEffect(() => { lucide.createIcons(); }, [name]);
            return React.createElement('i', {
                'data-lucide': name,
                width: size,
                height: size,
                className: className,
                ...props
            });
        };
    </script>

    <style>
        body { background-color: #09090b; color: white; overflow: hidden; }
        .glass-panel {
            background: rgba(20, 20, 20, 0.6);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        .history-item {
            transition: all 0.2s ease;
        }
        .history-item:active {
            transform: scale(0.98);
            background-color: rgba(255,255,255,0.05);
        }
        /* Hide scrollbar but allow scrolling */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .fullscreen-frame {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            border: none; z-index: 50; background: white;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [url, setUrl] = useState('');
            const [activeFrame, setActiveFrame] = useState(null);
            const [history, setHistory] = useState([]);
            const [installPrompt, setInstallPrompt] = useState(null);

            // Load History on Mount
            useEffect(() => {
                const saved = localStorage.getItem('fullscreen_history_v2');
                if (saved) {
                    setHistory(JSON.parse(saved));
                }
                window.addEventListener('beforeinstallprompt', (e) => {
                    e.preventDefault();
                    setInstallPrompt(e);
                });
                lucide.createIcons();
            }, []);

            // Save History whenever it changes
            useEffect(() => {
                localStorage.setItem('fullscreen_history_v2', JSON.stringify(history));
                lucide.createIcons();
            }, [history]);

            const loadSite = (inputUrl) => {
                if (!inputUrl.trim()) return;

                let formattedUrl = inputUrl.trim();
                if (!/^https?:\/\//i.test(formattedUrl)) {
                    formattedUrl = 'https://' + formattedUrl;
                }

                addToHistory(formattedUrl);
                setActiveFrame(formattedUrl);
            };

            const addToHistory = (validUrl) => {
                setHistory(prev => {
                    // Remove existing entry if it exists (to bubble it to top later)
                    const filtered = prev.filter(item => item.url !== validUrl);
                    
                    const newItem = {
                        id: Date.now(),
                        url: validUrl,
                        pinned: prev.find(p => p.url === validUrl)?.pinned || false, // Preserve pin status
                        lastVisited: Date.now()
                    };
                    return [newItem, ...filtered];
                });
            };

            const togglePin = (e, id) => {
                e.stopPropagation(); // Prevent loading the site when clicking pin
                setHistory(prev => prev.map(item => 
                    item.id === id ? { ...item, pinned: !item.pinned } : item
                ));
            };

            const deleteItem = (e, id) => {
                e.stopPropagation();
                setHistory(prev => prev.filter(item => item.id !== id));
            };

            const getDomain = (urlStr) => {
                try {
                    const domain = new URL(urlStr).hostname;
                    return domain.replace('www.', '');
                } catch (e) {
                    return urlStr;
                }
            };

            const handleInstall = async () => {
                if (!installPrompt) return;
                installPrompt.prompt();
                setInstallPrompt(null);
            };

            // Sorted History: Pinned first, then by date
            const sortedHistory = [...history].sort((a, b) => {
                if (a.pinned && !b.pinned) return -1;
                if (!a.pinned && b.pinned) return 1;
                return b.lastVisited - a.lastVisited; // Most recent first
            });

            // --- FULLSCREEN MODE ---
            if (activeFrame) {
                return (
                    <div className="w-full h-full bg-black">
                        <iframe 
                            src={activeFrame} 
                            className="fullscreen-frame"
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                            allowFullScreen
                        />
                    </div>
                );
            }

            // --- DASHBOARD MODE ---
            return (
                <div className="h-screen flex flex-col p-6 relative">
                    
                    {/* Header */}
                    <div className="flex flex-col items-center mt-8 mb-6 z-10">
                        <div className="p-3 bg-white/10 rounded-2xl mb-3 border border-white/10">
                            <Icon name="maximize" size={32} className="text-white" />
                        </div>
                        <h1 className="text-2xl font-bold tracking-wide">Fullscreen</h1>
                    </div>

                    {/* Input Area */}
                    <div className="w-full max-w-lg mx-auto z-10 mb-6">
                        <form onSubmit={(e) => { e.preventDefault(); loadSite(url); }} className="relative">
                            <input
                                type="text"
                                value={url}
                                onChange={(e) => setUrl(e.target.value)}
                                placeholder="Enter website URL..."
                                className="w-full bg-zinc-900/80 border border-zinc-700 text-white rounded-xl py-4 pl-4 pr-14 focus:outline-none focus:border-blue-500 focus:ring-1 focus:ring-blue-500 transition-all placeholder-zinc-500"
                            />
                            <button 
                                type="submit"
                                className="absolute right-2 top-2 bottom-2 bg-blue-600 hover:bg-blue-500 text-white px-3 rounded-lg transition-colors flex items-center justify-center"
                            >
                                <Icon name="arrow-right" size={20} />
                            </button>
                        </form>
                    </div>

                    {/* History List */}
                    <div className="flex-1 w-full max-w-lg mx-auto overflow-hidden flex flex-col z-10">
                        <h2 className="text-sm text-zinc-500 font-medium mb-3 px-1 uppercase tracking-wider flex justify-between items-center">
                            <span>History & Favorites</span>
                            {history.length > 0 && <span className="text-xs">{history.length} items</span>}
                        </h2>

                        <div className="flex-1 overflow-y-auto no-scrollbar pb-20 space-y-2">
                            {history.length === 0 && (
                                <div className="text-center text-zinc-600 mt-10">
                                    <p>No history yet.</p>
                                </div>
                            )}

                            {sortedHistory.map((item) => (
                                <div 
                                    key={item.id}
                                    onClick={() => loadSite(item.url)}
                                    className="history-item glass-panel p-3 rounded-xl flex items-center gap-3 cursor-pointer group"
                                >
                                    {/* Favicon / Icon */}
                                    <img 
                                        src={`https://www.google.com/s2/favicons?domain=${item.url}&sz=64`}
                                        onError={(e) => {e.target.style.display='none'}}
                                        className="w-8 h-8 rounded-md bg-white/10"
                                        alt="icon"
                                    />
                                    
                                    {/* Text Info */}
                                    <div className="flex-1 min-w-0">
                                        <div className="text-sm font-medium text-white truncate">
                                            {getDomain(item.url)}
                                        </div>
                                        <div className="text-xs text-zinc-500 truncate">
                                            {item.url}
                                        </div>
                                    </div>

                                    {/* Actions */}
                                    <div className="flex items-center gap-1">
                                        <button 
                                            onClick={(e) => togglePin(e, item.id)}
                                            className={`p-2 rounded-lg transition-colors ${item.pinned ? 'text-yellow-400' : 'text-zinc-600 hover:text-zinc-400'}`}
                                        >
                                            <Icon name="star" size={18} fill={item.pinned ? "currentColor" : "none"} />
                                        </button>
                                        <button 
                                            onClick={(e) => deleteItem(e, item.id)}
                                            className="p-2 rounded-lg text-zinc-600 hover:text-red-400 transition-colors"
                                        >
                                            <Icon name="trash-2" size={18} />
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>

                    {/* Install Bar (if available) */}
                    {installPrompt && (
                        <div className="absolute bottom-6 left-6 right-6 z-20">
                            <button 
                                onClick={handleInstall}
                                className="w-full bg-zinc-800 text-white font-medium py-3 rounded-xl shadow-lg border border-zinc-700 flex items-center justify-center gap-2"
                            >
                                <Icon name="download" size={18} />
                                <span>Install App</span>
                            </button>
                        </div>
                    )}

                    {/* Background Gradients */}
                    <div className="fixed top-0 left-0 right-0 h-full overflow-hidden pointer-events-none -z-10">
                         <div className="absolute top-[-10%] left-[-10%] w-[80vw] h-[80vw] bg-blue-900/20 rounded-full blur-[100px]"></div>
                         <div className="absolute bottom-[-10%] right-[-10%] w-[80vw] h-[80vw] bg-purple-900/20 rounded-full blur-[100px]"></div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>