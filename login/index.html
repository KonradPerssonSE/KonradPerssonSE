<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>System Access</title>
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  user-select: none; /* Prevents highlighting text on tap */
  -webkit-tap-highlight-color: transparent;
}

body {
  background: #000000;
  color: #0f0;
  font-family: 'Courier New', monospace;
  /* Dynamic font size to fit width on mobile */
  font-size: 2.4vw; 
  line-height: 1.1;
  overflow: hidden;
  height: 100vh;
  width: 100vw;
  position: fixed;
}

#canvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1;
}

#art {
  white-space: pre;
  text-align: left;
}

/* Hidden input to force Android keyboard */
#virtual-input {
  position: absolute;
  opacity: 0;
  top: -1000px;
}

.char {
  display: inline-block;
  opacity: 0;
  animation: twinkle 4s ease-in-out infinite;
}

@keyframes twinkle {
  0%, 100% { opacity: 0.3; }
  50% { opacity: 1; }
}

.input-char {
  animation: none;
  opacity: 1;
  font-weight: bold;
  color: #fff;
  text-shadow: 0 0 5px #0f0;
}

.login-btn {
  color: #0ff;
  cursor: pointer;
  font-weight: bold;
  animation: pulse 1.5s ease-in-out infinite;
  text-shadow: 0 0 8px #0ff;
}

@keyframes pulse {
  0%, 100% { opacity: 0.6; }
  50% { opacity: 1; }
}

/* Hint at the bottom for mobile users */
#hint {
  position: fixed;
  bottom: 20px;
  width: 100%;
  text-align: center;
  color: #0f0;
  opacity: 0.5;
  font-size: 12px;
  pointer-events: none;
  z-index: 10;
}
</style>
</head>
<body>

<input type="text" id="virtual-input" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false">

<div id="canvas">
  <div id="art"></div>
</div>
<div id="hint">TAP TERMINAL TO INITIALIZE INPUT</div>

<script>
// Adjusted grid size for mobile aspect ratios
const WIDTH = 42; 
const HEIGHT = 60; 
const CHARS = '·∴※☆★✦✧∘○◦∙•⋅';
const BOX_CHARS = {
  tl: '╔', tr: '╗', bl: '╚', br: '╝',
  h: '═', v: '║'
};

let grid = [];
let username = '';
let password = '';
let activeField = 'username'; // 'username' or 'password'
let loginBtnPos = null;

// Reference to the hidden input
const virtualInput = document.getElementById('virtual-input');

function initGrid() {
  grid = [];
  for (let y = 0; y < HEIGHT; y++) {
    grid[y] = [];
    for (let x = 0; x < WIDTH; x++) {
      if (Math.random() > 0.92) {
        grid[y][x] = CHARS[Math.floor(Math.random() * CHARS.length)];
      } else {
        grid[y][x] = ' ';
      }
    }
  }
}

function drawLoginBox() {
  const centerX = Math.floor(WIDTH / 2) - 7;
  const centerY = Math.floor(HEIGHT / 2) - 8; // Moved up slightly for mobile keyboard
  
  // --- Username Box ---
  const uy = centerY;
  drawBox(centerX, uy);
  writeText(centerX + 3, uy - 1, 'USERNAME');
  
  // --- Password Box ---
  const py = centerY + 5;
  drawBox(centerX, py);
  writeText(centerX + 3, py - 1, 'PASSWORD');
  
  // Fill Username
  for (let i = 0; i < 12; i++) {
    grid[uy + 1][centerX + 1 + i] = i < username.length ? username[i] : ' ';
  }
  
  // Fill Password (masked)
  for (let i = 0; i < 12; i++) {
    grid[py + 1][centerX + 1 + i] = i < password.length ? '●' : ' ';
  }
  
  // Active field indicator (Blown up cursor)
  if (activeField === 'username') {
    grid[uy + 1][centerX + 1 + username.length] = '█';
  } else {
    grid[py + 1][centerX + 1 + password.length] = '█';
  }

  // Touch Hitboxes logic (stored for click handler)
  window.boxCoords = {
    user: { y: uy, x: centerX },
    pass: { y: py, x: centerX }
  };
}

function drawBox(x, y) {
  grid[y][x] = BOX_CHARS.tl;
  grid[y][x + 13] = BOX_CHARS.tr;
  grid[y + 2][x] = BOX_CHARS.bl;
  grid[y + 2][x + 13] = BOX_CHARS.br;
  
  for (let i = 1; i < 13; i++) {
    grid[y][x + i] = BOX_CHARS.h;
    grid[y + 2][x + i] = BOX_CHARS.h;
  }
  grid[y + 1][x] = BOX_CHARS.v;
  grid[y + 1][x + 13] = BOX_CHARS.v;
}

function writeText(x, y, text) {
  for (let i = 0; i < text.length; i++) {
    grid[y][x + i] = text[i];
  }
}

function showLoginButton() {
  // Only show button if inputs are valid (>= 4 chars for easier testing)
  if (username.length >= 4 && password.length >= 4 && !loginBtnPos) {
    let attempts = 0;
    while (attempts < 50) {
      // Keep button in the middle area vertically
      const x = Math.floor(Math.random() * (WIDTH - 10)) + 1;
      const y = Math.floor(Math.random() * (HEIGHT - 20)) + 10;
      
      let clear = true;
      // Don't overwrite box drawing chars
      for (let i = 0; i < 9; i++) {
        if (grid[y][x + i] && /[╔╗╚╝═║USERNAMPWO]/.test(grid[y][x + i])) {
          clear = false; break;
        }
      }
      
      if (clear) {
        loginBtnPos = { x, y };
        break;
      }
      attempts++;
    }
  } else if ((username.length < 4 || password.length < 4) && loginBtnPos) {
    loginBtnPos = null;
  }
  
  if (loginBtnPos) {
    const text = '[ LOGIN ]';
    for (let i = 0; i < text.length; i++) {
      grid[loginBtnPos.y][loginBtnPos.x + i] = text[i];
    }
  }
}

function render() {
  const art = document.getElementById('art');
  let html = '';
  
  for (let y = 0; y < HEIGHT; y++) {
    for (let x = 0; x < WIDTH; x++) {
      const char = grid[y][x] || ' ';
      const delay = Math.random() * 4;
      
      const isLoginBtn = loginBtnPos && 
        y === loginBtnPos.y && 
        x >= loginBtnPos.x && 
        x < loginBtnPos.x + 9;
      
      // Highlight inputs
      const isInput = char === '█' || 
        (char.match(/[a-zA-Z0-9●]/) && !char.match(/[USERNAMPWO]/));
      
      if (isLoginBtn) {
        html += `<span class="char login-btn" style="animation-delay: ${delay}s">${char}</span>`;
      } else if (isInput) {
        html += `<span class="input-char">${char}</span>`;
      } else {
        html += `<span class="char" style="animation-delay: ${delay}s">${char}</span>`;
      }
    }
    html += '\n';
  }
  
  art.innerHTML = html;
}

// --- Interaction Handlers ---

function handleVirtualInput(e) {
    const val = virtualInput.value;
    const inputType = e.inputType;

    // Handle deletion
    if (inputType === 'deleteContentBackward') {
        if (activeField === 'username') username = username.slice(0, -1);
        else password = password.slice(0, -1);
    } 
    // Handle typing
    else if (val.length > 0) {
        const char = val.slice(-1);
        // Only accept alphanumeric
        if (/[a-zA-Z0-9]/.test(char)) {
            if (activeField === 'username' && username.length < 12) {
                username += char;
            } else if (activeField === 'password' && password.length < 12) {
                password += char;
            }
        }
    }
    
    // Reset input so we can detect next keystroke
    virtualInput.value = ''; 
    
    // Force refresh
    initGrid();
    drawLoginBox();
    showLoginButton();
    render();
}

// Main Click/Tap Handler
document.addEventListener('click', (e) => {
    const art = document.getElementById('art');
    
    // Always refocus the hidden input on tap so keyboard stays up
    virtualInput.focus();

    // Calculate where the user tapped within the grid
    const rect = art.getBoundingClientRect();
    
    // Approximate char dimensions
    const charWidth = rect.width / WIDTH;
    const charHeight = rect.height / HEIGHT;
    
    const clickX = Math.floor((e.clientX - rect.left) / charWidth);
    const clickY = Math.floor((e.clientY - rect.top) / charHeight);

    // Check Hitboxes for switching fields
    if (window.boxCoords) {
        // Username area tap
        if (clickY >= window.boxCoords.user.y && clickY <= window.boxCoords.user.y + 2) {
            activeField = 'username';
        }
        // Password area tap
        if (clickY >= window.boxCoords.pass.y && clickY <= window.boxCoords.pass.y + 2) {
            activeField = 'password';
        }
    }

    // Check Login Button Click
    if (loginBtnPos && 
        clickY === loginBtnPos.y && 
        clickX >= loginBtnPos.x && 
        clickX < loginBtnPos.x + 9) {
            
        alert(`ACCESS GRANTED\nUser: ${username}`);
        username = '';
        password = '';
        loginBtnPos = null;
        activeField = 'username';
    }

    initGrid();
    drawLoginBox();
    showLoginButton();
    render();
});

// Listen for input on the hidden field
virtualInput.addEventListener('input', handleVirtualInput);

// Initialize
initGrid();
drawLoginBox();
render();

// Background Animation Loop
setInterval(() => {
  // Only update random background noise, preserve boxes
  for (let i = 0; i < 5; i++) {
    const x = Math.floor(Math.random() * WIDTH);
    const y = Math.floor(Math.random() * HEIGHT);
    
    // Safety check to not overwrite UI elements
    const char = grid[y][x];
    const isSafe = char === ' ' || CHARS.includes(char);
    
    if (isSafe) {
      grid[y][x] = Math.random() > 0.5 ? CHARS[Math.floor(Math.random() * CHARS.length)] : ' ';
    }
  }
  drawLoginBox();
  showLoginButton();
  render();
}, 1000);

</script>
</body>
</html>